image: Visual Studio 2017
skip_tags: true

install:
  - set path=c:\Program Files (x86)\WiX Toolset v3.11\bin;%path%
  - |-
      echo export const VERSION = { buildID: '%APPVEYOR_BUILD_ID%', buildVersion: '%APPVEYOR_BUILD_VERSION%', buildNo: '%APPVEYOR_BUILD_NUMBER%', gitHash: '%APPVEYOR_REPO_COMMIT%', gitMessage: '%APPVEYOR_REPO_COMMIT_MESSAGE%' }> src/version.js
  - cat src/version.js
  - npm install

cache:
  - node_modules -> package.json
  - '%AppData%\npm\node_modules'

test_script:

build_script:
  - node --version
  - npm --version
  - npm run build -m
  - npm run package-win
  - ls C:\projects\schild-report\release\schild.report-win32-ia32\
  - C:\projects\schild-report\release\schild.report-win32-ia32\schild.report.exe -v
  - node create-msi.js

artifacts:
  - path: release/msi/schild.report.msi
    name: schild.report

deploy:
  release: v$(appveyor_build_version)
  description: 'Automatisiertes Push-Build. Für aktuelle Änderungen die Commit-Logs anschauen.'
  provider: GitHub
  auth_token:
    secure: xf39YWukS9Xjl8akZBdy3e/7xbl4pQn7qdpsguMuV2JcZkZ4zBj2nyh1D0ooi9pW
  artifact: release/msi/schild.report.msi
  draft: false
  prerelease: false
  on:
    branch: master
